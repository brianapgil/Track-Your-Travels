<section class="section">
  <div class="container">
    <h2 class="title">Edit Travel Entry</h2>
      {{#if logged_in}}
      {{!-- Form to edit travel entry --}}
        <form id="edit-entry-form">
          <input type="hidden" name="id" value="{{entry.id}}" />

          <div class="field">
            <label class="label" for="title">Title:</label>
            <div class="control">
              <input class="input" type="text" id="title" name="title" value="{{entry.title}}" required>
            </div>
          </div>
          <div class="field">
            <label class="label" for="description">Description:</label>
            <div class="control">
              <textarea class="textarea" id="description" name="description" required>{{entry.description}}</textarea>
            </div>
          </div>
          <div class="field">
            <label class="label" for="location">Location (Latitude, Longitude):</label>
            <div class="control">
              <input class="input" type="text" id="location" name="location" value="{{entry.location}}" placeholder="e.g., 40.712776, -74.005974" required>
            </div>
          </div>
          <div class="field">
            <label class="label" for="map">Map:</label>
            <div id="map" class="map-container" style="height: 400px; width: 100%;"></div>
          </div>
          <div class="control">
            <button class="button is-primary" type="submit">Update Entry</button>
            <button type="button" id="delete-entry-btn" class="button is-danger">Delete Entry</button>
          </div>
        </form>
      {{else}}
      <p class="subtitle">Please log in to edit this entry.</p>
      <a href="/login" class="button is-primary">Login</a>
    {{/if}}
  </div>
</section>

<!-- Mapbox JS -->
<script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css" rel="stylesheet">

<script>
  document.addEventListener('DOMContentLoaded', () => {
    mapboxgl.accessToken = '{{mapboxToken}}';

    const location = '{{entry.location}}'.split(',').map(coord => coord.trim());
    const latitude = parseFloat(location[0]);
    const longitude = parseFloat(location[1]);

    // Initialize the map
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [longitude, latitude], 
      zoom: 12
    });

    // Update the location field on click
    map.on('click', (e) => {
      const coordinates = e.lngLat;
      document.getElementById('location').value = `${coordinates.lat}, ${coordinates.lng}`;
    });
  });
</script>

<script src="/js/editEntry.js"></script>